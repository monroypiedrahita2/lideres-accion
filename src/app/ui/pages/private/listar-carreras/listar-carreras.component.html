<div class="p-6">
  <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
    <mg-title title="Carreras en curso"></mg-title>

    <div class="w-full md:w-1/3">
      <mg-input-select class="w-full" label="Filtrar por destino" [items]="destinosOptions"
        [formControl]="searchControl" placeholder="Seleccione un destino" [asyncSearch]="false">
      </mg-input-select>
    </div>
  </div>

  <!-- Mobile View: Cards -->
  <div class="md:hidden flex flex-col gap-4">
    <div class="relative" *ngFor="let carrera of dataSource.filteredData">
      <mtt-card-info [title]="carrera.nombreVotante || 'Sin nombre'"
        [textInfo]="(carrera.lugarRecogida) + ' -> ' + (carrera.puestoVotacionIr.nombre)" icon="directions_car"
        [activePoint]="false"></mtt-card-info>
      <!-- Actions removed as none were requested for now -->
    </div>

    <div *ngIf="dataSource.filteredData.length === 0" class="text-center p-4 text-gray-500 bg-white rounded-lg shadow">
      No se encontraron carreras en curso que coincidan con la búsqueda.
    </div>
  </div>

  <!-- Desktop View: Table -->
  <div class="hidden md:block overflow-auto rounded-lg shadow bg-white mb-4">
    <table mat-table [dataSource]="dataSource" class="w-full">

      <!-- Solicitante Column -->
      <ng-container matColumnDef="solicitante">
        <th mat-header-cell *matHeaderCellDef class="px-4 py-2 bg-gray-100 font-bold text-gray-700"> Solicitante </th>
        <td mat-cell *matCellDef="let element" class="px-4 py-2 border-b"> {{element.nombreVotante || 'N/A'}} </td>
      </ng-container>

      <!-- Origen Column -->
      <ng-container matColumnDef="origen">
        <th mat-header-cell *matHeaderCellDef class="px-4 py-2 bg-gray-100 font-bold text-gray-700"> Origen </th>
        <td mat-cell *matCellDef="let element" class="px-4 py-2 border-b"> {{element.lugarRecogida}} </td>
      </ng-container>

      <!-- Destino Column -->
      <ng-container matColumnDef="destino">
        <th mat-header-cell *matHeaderCellDef class="px-4 py-2 bg-gray-100 font-bold text-gray-700"> Destino </th>
        <td mat-cell *matCellDef="let element" class="px-4 py-2 border-b"> {{element.puestoVotacionIr.nombre}} </td>
      </ng-container>

      <!-- Conductor Column -->
      <ng-container matColumnDef="conductor">
        <th mat-header-cell *matHeaderCellDef class="px-4 py-2 bg-gray-100 font-bold text-gray-700"> Conductor </th>
        <td mat-cell *matCellDef="let element" class="px-4 py-2 border-b"> {{element.datosConductorAprobado?.nombre ||
          'Sin Asignar'}} </td>
      </ng-container>

      <!-- Placa Column -->
      <ng-container matColumnDef="placa">
        <th mat-header-cell *matHeaderCellDef class="px-4 py-2 bg-gray-100 font-bold text-gray-700"> Placa </th>
        <td mat-cell *matCellDef="let element" class="px-4 py-2 border-b">
          {{element.datosConductorAprobado?.placaVehiculo || 'N/A'}} </td>
      </ng-container>

      <!-- Telefono Column -->
      <ng-container matColumnDef="telefono">
        <th mat-header-cell *matHeaderCellDef class="px-4 py-2 bg-gray-100 font-bold text-gray-700"> Teléfono </th>
        <td mat-cell *matCellDef="let element" class="px-4 py-2 border-b">
          <a *ngIf="element.datosConductorAprobado?.telefono" [href]="'tel:' + element.datosConductorAprobado?.telefono"
            class="text-blue-600 hover:text-blue-800">
            <mat-icon>phone</mat-icon>
          </a>
          <span *ngIf="!element.datosConductorAprobado?.telefono" class="text-gray-400">N/A</span>
        </td>
      </ng-container>

      <!-- Estado Column -->
      <ng-container matColumnDef="estado">
        <th mat-header-cell *matHeaderCellDef class="px-4 py-2 bg-gray-100 font-bold text-gray-700"> Estado </th>
        <td mat-cell *matCellDef="let element" class="px-4 py-2 border-b">
          <span class="px-2 py-1 rounded-full text-xs font-semibold"
            [ngClass]="{'bg-green-100 text-green-800': element.estado === 'En ruta', 'bg-gray-100 text-gray-800': element.estado !== 'En ruta'}">
            {{element.estado}}
          </span>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover:bg-gray-50"></tr>
    </table>
    <div *ngIf="dataSource.filteredData.length === 0" class="text-center p-4 text-gray-500">
      No se encontraron carreras en curso que coincidan con la búsqueda.
    </div>
  </div>


</div>
<app-spinner [showSpinner]="showSpinner"></app-spinner>