<div class="mt-4 bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden">
    <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start" animationDuration="0ms">

        <!-- Tab 1: Mis Carreras -->
        <mat-tab label="Mis Carreras">
            <div class="p-4 flex flex-col gap-4 min-h-[200px]">
                <div *ngIf="loadingMisCarreras" class="text-center text-gray-500 py-4">
                    Cargando tus carreras...
                </div>

                <div *ngIf="!loadingMisCarreras && misCarreras.length === 0" class="text-center text-gray-500 py-8">
                    No has solicitado ni tomado ninguna carrera.
                </div>

                <div *ngFor="let carrera of misCarreras"
                    class="border rounded-lg p-3 hover:shadow-md transition-shadow bg-gray-50">
                    <div class="flex justify-between items-start mb-2">
                        <span class="font-bold text-gray-800">{{ carrera.lugarRecogida }} → {{ carrera.puestoVotacionIr
                            }}</span>
                        <span class="text-xs px-2 py-1 rounded-full border" [ngClass]="{
                                'bg-yellow-100 text-yellow-800 border-yellow-200': carrera.estado === 'Abierto',
                                'bg-blue-100 text-blue-800 border-blue-200': carrera.estado === 'En ruta',
                                'bg-green-100 text-green-800 border-green-200': carrera.estado === 'Finalizada',
                                'bg-red-100 text-red-800 border-red-200': carrera.estado === 'Cancelada'
                            }">
                            {{ carrera.estado }}
                        </span>
                    </div>
                    <p class="text-xs text-gray-600 mb-2">{{ carrera.observaciones || 'Sin observaciones' }}</p>

                    <!-- Postulants Section (Only for 'Abierto' and Creator) -->
                    <div *ngIf="carrera.estado === 'Abierto' && carrera.postulados && carrera.postulados.length > 0"
                        class="mt-3 border-t border-gray-200 pt-2">
                        <span class="text-xs font-bold text-gray-700 block mb-2">Vehículos Postulados:</span>
                        <div class="flex flex-col gap-2">
                            <div *ngFor="let postulado of carrera.postulados"
                                class="flex items-center justify-between bg-white p-2 rounded border border-gray-100">
                                <span class="text-xs text-gray-600">
                                    <mat-icon class="!text-sm !w-4 !h-4 align-middle mr-1">directions_car</mat-icon>
                                    Cerca a {{ getDistanciaPostulado(postulado, carrera) }}
                                </span>
                                <button mat-stroked-button color="primary" class="!scale-75 origin-right"
                                    (click)="aprobarConductor(carrera, postulado)">
                                    Aprobar
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Actions logic for communication -->
                    <div class="flex gap-2 justify-end mt-2 pt-2 border-t border-gray-200">
                    </div>
                </div>
            </div>
        </mat-tab>

        <!-- Tab 2: Buscar -->
        <mat-tab label="Buscar">
            <div class="p-4 flex flex-col gap-4 min-h-[200px]">

                <div *ngIf="vehiculoMensaje"
                    class="p-4 bg-yellow-50 text-yellow-800 rounded-lg text-sm mb-2 flex items-start gap-2">
                    <mat-icon class="text-yellow-600 icon-sm">info</mat-icon>
                    <span>{{ vehiculoMensaje }}</span>
                </div>

                <div *ngIf="loadingBuscar && !vehiculoMensaje" class="text-center text-gray-500 py-4">
                    Buscando carreras disponibles...
                </div>

                <div *ngIf="!loadingBuscar && !vehiculoMensaje && carrerasDisponibles.length === 0"
                    class="text-center text-gray-500 py-8">
                    No hay carreras disponibles para tu tipo de vehículo en este momento.
                </div>

                <div *ngFor="let carrera of carrerasDisponibles"
                    class="border rounded-lg p-3 hover:shadow-md transition-shadow bg-white">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex flex-col">
                            <span class="font-bold text-gray-800 text-sm">Recoger en: {{ carrera.lugarRecogida }}</span>
                            <span class="text-xs text-gray-500">Destino: {{ carrera.puestoVotacionIr }}</span>

                            <!-- Local type CarreraWithDistance used here -->
                            <div *ngIf="carrera.distancia"
                                class="flex items-center mt-1 gap-1 text-xs text-blue-600 bg-blue-50 px-2 py-0.5 rounded-full w-fit">
                                <mat-icon class="!text-sm !w-4 !h-4">near_me</mat-icon>
                                <span class="font-bold">{{ carrera.distancia }} km (~{{ carrera.tiempoEstimado }}
                                    min)</span>
                            </div>
                        </div>
                        <span class="text-xs px-2 py-1 rounded-full bg-green-50 text-green-700 border border-green-100">
                            {{ carrera.tipoVehiculo }}
                        </span>
                    </div>

                    <p class="text-xs text-gray-600 mb-3 bg-gray-50 p-2 rounded">{{ carrera.observaciones || 'Sin
                        observaciones' }}</p>

                    <div class="flex items-center justify-between mt-2 pt-2 border-t border-gray-100">
                        <span class="text-xs text-blue-600 font-medium">Contactar:</span>
                        <div class="flex gap-2">
                            <!-- WhatsApp Solicitante -->
                            <a [href]="getWhatsAppLink(carrera.telefonoSolicitante)" target="_blank"
                                class="flex items-center justify-center w-8 h-8 rounded-full bg-green-50 hover:bg-green-100 text-green-600 transition-colors border border-green-200"
                                title="WhatsApp Solicitante">
                                <img src="assets/whatsApp.svg" alt="WhatsApp" class="w-5 h-5">
                            </a>
                            <!-- Call Solicitante -->
                            <a [href]="'tel:' + carrera.telefonoSolicitante"
                                class="flex items-center justify-center w-8 h-8 rounded-full bg-blue-50 hover:bg-blue-100 text-blue-600 transition-colors border border-blue-200"
                                title="Llamar Solicitante">
                                <mat-icon class="!text-sm !w-4 !h-4 flex items-center justify-center">call</mat-icon>
                            </a>
                        </div>
                    </div>
                    <!-- Postularse Button -->
                    <button mat-flat-button color="primary" class="w-full mt-3 !rounded-full"
                        (click)="postularse(carrera)">
                        <mat-icon class="mr-2">pan_tool</mat-icon>
                        Postularme
                    </button>
                </div>
            </div>
        </mat-tab>

    </mat-tab-group>
</div>