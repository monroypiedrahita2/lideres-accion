<div class="p-4 flex flex-col gap-4 min-h-[200px]">

    <div *ngIf="vehiculoMensaje"
        class="p-4 bg-yellow-50 text-yellow-800 rounded-lg text-sm mb-2 flex items-start gap-2">
        <mat-icon class="text-yellow-600 icon-sm">info</mat-icon>
        <span>{{ vehiculoMensaje }}</span>
    </div>

    <!-- Filter Section -->
    <div *ngIf="showFilter" class="flex flex-col gap-2 mb-2">
        <span class="text-xs text-gray-500 font-medium ml-1">Filtrar por vehículo:</span>
        <mat-chip-listbox [multiple]="true">
            <mat-chip-option *ngFor="let type of availableTypes" [selected]="selectedTypes.includes(type)"
                (click)="toggleType(type)" color="primary">
                {{ type }}
            </mat-chip-option>
        </mat-chip-listbox>
    </div>

    <div *ngIf="loadingBuscar && !vehiculoMensaje" class="text-center text-gray-500 py-4">
        Buscando carreras disponibles...
    </div>

    <div *ngIf="!loadingBuscar && !vehiculoMensaje && carrerasDisponibles.length === 0"
        class="text-center text-gray-800 text-lg py-8">
        No hay carreras disponibles para tu tipo de vehículo en este momento.
    </div>

    <div *ngFor="let carrera of carrerasDisponibles"
        class="border rounded-lg p-3 hover:shadow-md transition-shadow bg-white">
        <div class="flex justify-between mb-2 w-full">
            <div class="flex flex-col justify-center items-center w-full">
                <span class="font-bold text-gray-800 text-lg text-center">{{ carrera.lugarRecogida }}</span>
                <span class="text-xl text-gray-500 text-center">{{ carrera.puestoVotacionIr.nombre }}</span>

                <!-- Local type CarreraWithDistance used here -->
                <div class="flex justify-between w-full items-center">
                    <div *ngIf="carrera.distancia"
                        class="flex items-center justify-between mt-1 gap-1 text-xs text-blue-600 bg-blue-50 px-2 py-0.5 rounded-full w-fit">
                        <mat-icon class="!text-sm !w-4 !h-4">near_me</mat-icon>
                        <span class="font-bold text-xl">{{ carrera.distancia }} km (~{{ carrera.tiempoEstimado }}
                            min)</span>
                    </div>
                    <span class="text-lg px-2 py-1 rounded-full bg-green-50 text-green-700 border border-green-100">
                        {{ carrera.tipoVehiculo }}
                    </span>

                </div>
            </div>

        </div>

        <p class="text-lg text-red-700 font-medium mb-3 bg-red-50 p-2 rounded text-center border border-red-100">{{
            carrera.observaciones || 'Sin observaciones' }}
        </p>

        <div class="flex items-center justify-between mt-2 pt-2 border-t border-gray-100">
            <span class="text-xs text-blue-600 font-medium">Contactar:</span>
            <div class="flex gap-2">
                <!-- WhatsApp Solicitante -->
                <mg-icon-whatsapp [phone]="carrera.telefonoSolicitante" size="small"></mg-icon-whatsapp>
                <!-- Call Solicitante -->
                <mg-icon-button icon="call" [link]="'tel:' + carrera.telefonoSolicitante" variant="info"
                    size="small"></mg-icon-button>
            </div>
        </div>
        <!-- Postularse Button -->
        <!-- Postularse Button -->
        <button mat-flat-button [color]="isPostulated(carrera) ? 'warn' : 'primary'" class="w-full mt-3 !rounded-full"
            [disabled]="!isPostulated(carrera) && hasActivePostulation" (click)="togglePostulacion(carrera)">
            <mat-icon class="mr-2">{{ isPostulated(carrera) ? 'cancel' : 'pan_tool' }}</mat-icon>
            {{ isPostulated(carrera) ? 'Eliminar Postulación' : 'Postularme' }}
        </button>
    </div>
</div>