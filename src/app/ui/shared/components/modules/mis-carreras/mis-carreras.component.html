<div class="p-4 flex flex-col gap-4 min-h-[200px]">
    <div *ngIf="loadingMisCarreras" class="text-center text-gray-500 py-4">
        Cargando tus carreras...
    </div>

    <div *ngIf="!loadingMisCarreras && misCarreras.length === 0" class="text-center text-gray-500 py-8">
        No has solicitado ni tomado ninguna carrera.
    </div>

    <div *ngFor="let carrera of misCarreras" class="border rounded-lg p-3 hover:shadow-md transition-shadow bg-gray-50">
        <div class="flex justify-between items-start mb-2">
            <span class="font-bold text-gray-800">{{ carrera.lugarRecogida }} → {{ carrera.puestoVotacionIr.nombre }}</span>
            <div class="flex items-center gap-2">
                <span class="text-xs px-2 py-1 rounded-full border" [ngClass]="{
                        'bg-yellow-100 text-yellow-800 border-yellow-200': carrera.estado === 'Abierto',
                        'bg-blue-100 text-blue-800 border-blue-200': carrera.estado === 'En ruta',
                        'bg-green-100 text-green-800 border-green-200': carrera.estado === 'Finalizada',
                        'bg-red-100 text-red-800 border-red-200': carrera.estado === 'Cancelada'
                    }">
                    {{ carrera.estado }}
                </span>
                <mg-icon-button icon="delete" variant="danger" size="small" (onClick)="eliminarCarrera(carrera)"
                    title="Eliminar Carrera"></mg-icon-button>
            </div>
        </div>
        <p class="text-xs text-gray-600 mb-2">{{ carrera.observaciones || 'Sin observaciones' }}</p>

        <!-- Postulants Section (Only for 'Abierto' and Creator) -->
        <div *ngIf="carrera.estado === 'Abierto' && carrera.postulados && carrera.postulados.length > 0"
            class="mt-3 border-t border-gray-200 pt-2">
            <span class="text-xs font-bold text-gray-700 block mb-2">Vehículos Postulados:</span>
            <div class="flex flex-col gap-2">
                <div *ngFor="let postulado of carrera.postulados"
                    class="flex items-center justify-between bg-white p-2 rounded border border-gray-100">
                    <div class="flex flex-col">
                        <span class="text-sm font-bold text-gray-800">
                            {{ postulantesData.get(postulado.id || '')?.nombre }} {{ postulantesData.get(postulado.id ||
                            '')?.apellidos }}
                        </span>
                        <span class="text-xs text-gray-600">
                            <mat-icon class="!text-sm !w-4 !h-4 align-middle mr-1">access_time</mat-icon>
                            Aprox {{ getTiempoAproximado(postulado, carrera) }} - {{ getDistanciaAproximado(postulado,
                            carrera) }} km
                        </span>
                    </div>
                    <div class="flex gap-2">
                        <button mat-stroked-button color="warn" class="!scale-75 origin-right"
                            (click)="eliminarPostulacion(carrera, postulado)">
                            Eliminar
                        </button>
                        <button mat-stroked-button color="primary" class="!scale-75 origin-right"
                            (click)="aprobarConductor(carrera, postulado)">
                            Aprobar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Approved Vehicle Info (For 'En ruta' or 'Finalizada') -->
        <div *ngIf="(carrera.estado === 'En ruta' || carrera.estado === 'Finalizada') && carrera.datosConductorAprobado"
            class="mt-3 border-t border-gray-200 pt-2">
            <div class="flex justify-between items-center mb-2">
                <span class="text-xs font-bold text-gray-700">Vehículo Asignado:</span>
                <!-- <mg-icon-button *ngIf="carrera.estado === 'En ruta'" icon="delete" variant="danger" size="small"
                    (onClick)="desasignarVehiculo(carrera)" title="Eliminar Selección"></mg-icon-button> -->
            </div>
            <div class="flex items-start gap-3 bg-blue-50 p-2 rounded border border-blue-100">
                <!-- Vehicle/Driver Photo if available, else icon -->
                <div
                    class="w-10 h-10 rounded-full bg-white flex items-center justify-center overflow-hidden border border-blue-200 shadow-sm shrink-0">
                    <img *ngIf="carrera.datosConductorAprobado.foto" [src]="carrera.datosConductorAprobado.foto"
                        alt="Conductor" class="w-full h-full object-cover">
                    <mat-icon *ngIf="!carrera.datosConductorAprobado.foto" class="text-blue-400">person</mat-icon>
                </div>

                <div class="flex flex-col flex-1">
                    <span class="text-sm font-bold text-gray-800">{{ carrera.datosConductorAprobado.nombre }}</span>
                    <span class="text-xs text-gray-600">{{ carrera.datosConductorAprobado.modeloVehiculo }} - {{
                        carrera.datosConductorAprobado.colorVehiculo }}</span>
                    <span
                        class="text-xs text-gray-500 font-mono bg-white px-1 rounded border border-gray-200 w-fit mt-1">{{
                        carrera.datosConductorAprobado.placaVehiculo }}</span>
                </div>

                <!-- Call Button -->
                <mg-icon-button icon="call" [link]="'tel:' + carrera.datosConductorAprobado.telefono" variant="success"
                    size="small" title="Llamar Conductor"></mg-icon-button>
            </div>
        </div>

    </div>
</div>